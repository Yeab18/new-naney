<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Na-Ney Fashion | Coats</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      /* Match styling like dresses page */
      .product-link {
        cursor: pointer;
        background-color: #f9e5e543;
        border: 2px solid rgba(221, 213, 204, 0.32);
        border-radius: 25px;
        overflow: hidden;
        text-decoration: none;
        color: #f5f5f5;
        transition: transform 0.3s;
        display: block;
      }

      .product-link:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(255, 255, 255, 0.1);
      }

      .product-link img {
        width: 100%;
        height: 80%;
        object-fit: cover;
        border-bottom: 1px solid #444;
      }

      .product-link p {
        padding: 0.8rem;
        margin: 0;
        font-weight: 300;
        text-align: center;
        color: #000000;
      }

      .loading {
        text-align: center;
        font-size: 1.2rem;
        color: #f5f5f5;
        padding: 2rem;
        background: #1c1c1c;
        border-radius: 8px;
        max-width: 300px;
        margin: 2rem auto;
      }

      /* Modal styles (must be included in every page) */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        overflow: auto;
      }

      .modal-content {
        background-color: #1c1c1c;
        color: #ffffff;
        margin: 10% auto;
        padding: 2rem;
        border-radius: 12px;
        width: 90%;
        max-width: 450px;
        position: relative;
        box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
      }

      .modal-close {
        color: #f5f5f5;
        position: absolute;
        top: 12px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .modal-close:hover {
        color: #ffffff;
      }

      #modalImage {
        width: 100%;

        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .modal-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 1.5rem;
        gap: 10px;
      }

      #modalQuantity {
        width: 60px;
        padding: 8px;
        border: 1px solid #555;
        border-radius: 4px;
        text-align: center;
        background: #000;
        color: #f5f5f5;
      }

      #addToCartBtn {
        background-color: #333;
        color: #f5f5f5;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.3s;
      }

      #addToCartBtn:hover {
        background-color: #ff0000a1;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="menu-toggle" id="menu-toggle">&#9776;</div>
      <ul id="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="coats.html" class="active">Coats</a></li>
        <li><a href="tops.html">Tops</a></li>
        <li><a href="dresses.html">Dresses</a></li>
        <li><a href="shoes.html">Shoes</a></li>
        <li><a href="bags.html">Bags</a></li>
        <li><a href="pants.html">Pants</a></li>
        <li><a href="accessories.html">Accessories</a></li>
        <li><a href="cart.html">Cart</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>

    <header>
    <h1>ና-ነይ</h1>
    <p>Coats</p>
    </header>

    <main>
      <section class="coat-gallery" id="products-container">
        <div class="loading">Loading coats...</div>
      </section>
    </main>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
      <div class="modal-content">
        <span class="modal-close">&times;</span>
        <img id="modalImage" src="" alt="Product Image" />
        <h2 id="modalTitle"></h2>
        <p id="modalDescription"></p>
        <p class="price" id="modalPrice"></p>
        <div class="modal-controls">
          <input type="number" id="modalQuantity" value="1" min="1" />
          <button id="addToCartBtn">Add to Cart</button>
        </div>
      </div>
    </div>

    <footer>
      <p>
        &copy; 2025 Na-Ney Fashion |
        <a href="https://t.me/LAMROT2121" target="_blank"
          ><i class="fab fa-telegram"></i> Telegram</a
        >
        |
        <a href="https://www.tiktok.com/@naney.fashion" target="_blank"
          ><i class="fab fa-tiktok"></i> TikTok</a
        >
        |
        <a href="tel:+251961434825"><i class="fas fa-phone-alt"></i> Call Us</a>
      </p>
    </footer>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        deleteDoc,
        doc,
      } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAcP8ABDFtJopiaHMkSSZ-q7m4diXjIPRY",
        authDomain: "naney-d1e8e.firebaseapp.com",
        projectId: "naney-d1e8e",
        storageBucket: "naney-d1e8e.appspot.com",
        messagingSenderId: "135021574178",
        appId: "1:135021574178:web:60982ef001d4b3361ff27b",
        measurementId: "G-7SMTN04YD4",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      const adminEmails = ["admin@example.com", "naneyfashion@gmail.com"]; // your admin emails
      let isAdmin = false;

      onAuthStateChanged(auth, (user) => {
        if (user && adminEmails.includes(user.email)) {
          isAdmin = true;
        }
        loadProducts(); // Load products only after auth check
      });

      async function loadProducts() {
        const querySnapshot = await getDocs(collection(db, "products"));
        const container = document.getElementById("products-container");
        let html = "";

        querySnapshot.forEach((docSnap) => {
          const product = docSnap.data();
          const id = docSnap.id;

          if (product.category === "coats") {
            html += `
          <div class="product-link" data-product='${JSON.stringify(
            product
          )}' data-id="${id}">
            <img src="${product.image}" alt="${product.description}">
            <p>${product.description} - ETB ${product.price}</p>
            ${
              isAdmin
                ? `<button class="delete-btn" data-id="${id}">Delete</button>`
                : ""
            }
          </div>
        `;
          }
        });

        container.innerHTML = html || "<p>No coats available</p>";
        setupModalListeners();
        if (isAdmin) setupDeleteButtons();
      }

      function setupModalListeners() {
        document.querySelectorAll(".product-link").forEach((item) => {
          item.addEventListener("click", (e) => {
            if (e.target.classList.contains("delete-btn")) return;
            e.preventDefault();
            const product = JSON.parse(item.dataset.product);
            openModal(product);
          });
        });

        document.querySelector(".modal-close").addEventListener("click", () => {
          document.getElementById("productModal").style.display = "none";
        });

        document
          .getElementById("addToCartBtn")
          .addEventListener("click", addToCart);
      }

      function setupDeleteButtons() {
        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const id = btn.dataset.id;
            if (confirm("Are you sure you want to delete this item?")) {
              await deleteDoc(doc(db, "products", id));
              alert("Deleted successfully");
              loadProducts();
            }
          });
        });
      }

      function openModal(product) {
        document.getElementById("modalImage").src = product.image;
        document.getElementById("modalTitle").textContent = product.description;
        document.getElementById(
          "modalDescription"
        ).textContent = `Size: ${product.size}`;
        document.getElementById("modalPrice").textContent = `$${product.price}`;
        document.getElementById("modalQuantity").value = 1;
        document.getElementById("productModal").style.display = "flex";
      }
      function closeModal() {
        document.getElementById("productModal").style.display = "none";
      }function addToCart() {
  const quantity = parseInt(document.getElementById("modalQuantity").value);
  const product = {
    description: document.getElementById("modalTitle").textContent,
    price: document.getElementById("modalPrice").textContent, // Keep as string like "$59.99"
    size: document
      .getElementById("modalDescription")
      .textContent.replace("Size: ", ""),
    image: document.getElementById("modalImage").src,
    quantity,
  };

  const CART_KEY = "naneyFashionCart"; // Use same key as cart.html
  let cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
  cart.push(product);
  localStorage.setItem(CART_KEY, JSON.stringify(cart));

  alert(`${quantity} item(s) added to cart`);
  document.getElementById("productModal").style.display = "none";
}

      document
        .getElementById("menu-toggle")
        .addEventListener("click", function () {
          document.getElementById("nav-menu").classList.toggle("open");
        });
      document.addEventListener("DOMContentLoaded", function () {
        loadProducts();

        // Close modal if clicked outside content
        window.addEventListener("click", function (event) {
          if (event.target === document.getElementById("productModal")) {
            closeModal();
          }
        });
      });
    </script>
  </body>
</html>
